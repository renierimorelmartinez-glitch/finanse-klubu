generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum MonthStatus {
  OPEN
  CLOSED
}

model Category {
  id             String          @id @default(uuid())
  name           String
  type           TransactionType
  defaultVatRate Int             @default(23)
  isFrequent     Boolean         @default(false)
  sortOrder      Int             @default(0)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  transactions   Transaction[]
  recurringRules RecurringRule[]

  @@map("categories")
}

model Transaction {
  id                          String          @id @default(uuid())
  type                        TransactionType
  categoryId                  String
  grossAmount                 Decimal         @db.Decimal(12, 2)
  vatRate                     Int
  netAmount                   Decimal         @db.Decimal(12, 2)
  vatAmount                   Decimal         @db.Decimal(12, 2)
  occurredAt                  DateTime        @db.Date
  month                       String          // "YYYY-MM"
  note                        String?
  attachmentUrl               String?
  generatedFromRecurringRuleId String?
  isLocked                    Boolean         @default(false)
  createdAt                   DateTime        @default(now())
  updatedAt                   DateTime        @updatedAt

  category                    Category        @relation(fields: [categoryId], references: [id])
  recurringRule               RecurringRule?  @relation(fields: [generatedFromRecurringRuleId], references: [id])

  @@index([month])
  @@index([type])
  @@index([categoryId])
  @@map("transactions")
}

model RecurringRule {
  id          String   @id @default(uuid())
  name        String
  categoryId  String
  grossAmount Decimal  @db.Decimal(12, 2)
  vatRate     Int
  dayOfMonth  Int
  isActive    Boolean  @default(true)
  startMonth  String   // "YYYY-MM"
  endMonth    String?  // "YYYY-MM" or null
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  category     Category      @relation(fields: [categoryId], references: [id])
  transactions Transaction[]

  @@map("recurring_rules")
}

model MonthParams {
  month               String      @id // "YYYY-MM"
  zusAmount           Decimal     @default(0) @db.Decimal(12, 2)
  pitAmount           Decimal     @default(0) @db.Decimal(12, 2)
  vatAdjustmentAmount Decimal     @default(0) @db.Decimal(12, 2)
  status              MonthStatus @default(OPEN)
  closedAt            DateTime?
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  @@map("month_params")
}
